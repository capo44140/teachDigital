---
globs: **/*
description: Vue d'ensemble de l'architecture TeachDigital - Frontend/Backend s√©par√©s
alwaysApply: true
---

# Architecture TeachDigital - Vue d'Ensemble

## üèóÔ∏è Architecture G√©n√©rale

### Principe Fondamental
**Le frontend ne fait QUE des appels API au backend. Aucune logique m√©tier dans le frontend.**

```
Frontend (Vue.js 3)
    ‚Üì Appels HTTP uniquement (via apiService)
Backend API (Vercel Functions)
    ‚Üì Logique m√©tier + Base de donn√©es
PostgreSQL Database
```

## üìÅ Structure du Projet

### Frontend (`src/`)
- **Composants** : `src/components/` - Composants Vue.js uniquement UI
- **Services** : `src/services/` - Uniquement des appels API, pas de logique m√©tier
- **Stores** : `src/stores/` - Gestion d'√©tat Pinia (donn√©es depuis API)
- **Router** : `src/router/` - Navigation Vue Router

### Backend (`backend/`)
- **API** : `backend/api/` - Endpoints Vercel Functions
- **Lib** : `backend/lib/` - Utilitaires (database, auth, cors, etc.)
- **Logique m√©tier** : Toute la logique m√©tier est dans le backend

## üîå Communication Frontend/Backend

### Service API Principal
Tous les appels backend passent par `src/services/apiService.js` :

```javascript
import { apiService } from './apiService.js'

// Exemple d'utilisation
const profiles = await apiService.getProfiles()
const profile = await apiService.getProfile(id)
await apiService.createProfile(profileData)
```

### Format des R√©ponses Backend
Le backend retourne toujours ce format :
```javascript
{
  success: true|false,
  message: "Message descriptif",
  data: { /* donn√©es */ }
}
```

## üóÑÔ∏è Base de Donn√©es

### Configuration
- **Type** : PostgreSQL (pas Neon)
- **Variable** : `DATABASE_URL` (format PostgreSQL standard)
- **Pool** : Utilise `pg` (Pool PostgreSQL natif)
- **Backend uniquement** : Le frontend n'acc√®de JAMAIS √† la base de donn√©es

### Acc√®s Base de Donn√©es
```javascript
// ‚úÖ BON - Backend uniquement
const { sql } = require('../lib/database.js')
const profiles = await sql`SELECT * FROM profiles`

// ‚ùå MAUVAIS - Frontend
import sql from '@/config/database.js' // INTERDIT
```

## üö´ R√®gles Strictes

### Frontend - INTERDICTIONS
1. ‚ùå **Aucun acc√®s direct √† la base de donn√©es**
2. ‚ùå **Aucune logique m√©tier** (calculs, validations complexes, etc.)
3. ‚ùå **Aucune requ√™te SQL** dans le frontend
4. ‚ùå **Aucun import de `database.js`** dans le frontend

### Frontend - AUTORISATIONS
1. ‚úÖ **Appels API uniquement** via `apiService`
2. ‚úÖ **Validation UI simple** (format, champs requis)
3. ‚úÖ **Gestion d'√©tat** avec Pinia
4. ‚úÖ **Formatage d'affichage** (dates, nombres, etc.)

### Backend - RESPONSABILIT√âS
1. ‚úÖ **Toute la logique m√©tier**
2. ‚úÖ **Validation des donn√©es**
3. ‚úÖ **Acc√®s √† la base de donn√©es**
4. ‚úÖ **Authentification et autorisation**
5. ‚úÖ **Gestion des erreurs**

## üìù Exemples de Code

### ‚úÖ Frontend - Appel API
```javascript
// src/services/badgeService.js
import { apiService } from './apiService.js'

export class BadgeService {
  async getAllBadges() {
    const response = await apiService.request('/api/badges')
    return response.data || []
  }
}
```

### ‚úÖ Backend - Logique M√©tier
```javascript
// backend/api/badges.js
const { sql } = require('../lib/database.js')

async function handleGetAllBadges(req, res) {
  const badges = await sql`
    SELECT * FROM badges 
    ORDER BY category, condition_value ASC
  `
  return res.status(200).json({
    success: true,
    message: 'Badges r√©cup√©r√©s avec succ√®s',
    data: badges
  })
}
```

### ‚ùå Frontend - √Ä NE JAMAIS FAIRE
```javascript
// ‚ùå INTERDIT - Acc√®s direct DB
import sql from '@/config/database.js'
const profiles = await sql`SELECT * FROM profiles`

// ‚ùå INTERDIT - Logique m√©tier
function calculateBadgeProgress(badge) {
  // Calculs complexes...
}

// ‚ùå INTERDIT - Validation serveur
function validateProfile(profile) {
  // Validation complexe...
}
```

## üîê Authentification

### Frontend
```javascript
// Token stock√© dans localStorage
const token = localStorage.getItem('auth_token')

// Ajout√© automatiquement par apiService
apiService.request('/api/profiles', {
  headers: { 'Authorization': `Bearer ${token}` }
})
```

### Backend
```javascript
// backend/lib/auth.js
const { authenticateToken } = require('../lib/auth.js')

const user = authenticateToken(req)
if (!user.isAdmin) {
  return res.status(403).json({ success: false, message: 'Acc√®s refus√©' })
}
```

## üéØ Bonnes Pratiques

### Services Frontend
- **Uniquement des appels API**
- **Pas de logique m√©tier**
- **Gestion d'erreurs simple** (catch et throw)
- **Formatage des donn√©es pour l'affichage uniquement**

### Services Backend
- **Toute la logique m√©tier**
- **Validation compl√®te des donn√©es**
- **Gestion d'erreurs robuste**
- **Logs d'audit pour les actions sensibles**

### Composants Vue
- **Appelent les services frontend**
- **G√®rent l'√©tat UI uniquement**
- **Pas de logique m√©tier**
- **Validation UI simple** (champs requis, format)

## üìö R√©f√©rences

- **API Service** : [src/services/apiService.js](mdc:src/services/apiService.js)
- **Database Backend** : [backend/lib/database.js](mdc:backend/lib/database.js)
- **Exemple API** : [backend/api/badges.js](mdc:backend/api/badges.js)
- **Exemple Service Frontend** : [src/services/badgeService.js](mdc:src/services/badgeService.js)
